{% extends 'base.layout.html.twig' %}

{% block title %}Downtime{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/downtime.css') }}"/>
{% endblock %}

{% block javascripts %}
    <script src="{{ asset('js/downtime.js') }}"></script>
{% endblock %}

{% block body %}
    <div class="container">
        <h1>
            Downtime
            <small>
                <a href="#" data-toggle="modal" data-target="#normal-downtime">Crea Downtime</a>
            </small>
        </h1>
        <div class="row">
            <div class="col-xs-12">
                <div id="downtime-page">
                    {{ render(controller(
                        'App\\Controller\\DowntimeController::renderResult'
                    )) }}
                </div>
                {% if (pagesCount != 1) %}
                <div class="load-more-button row">
                    <div class="col-xs-12">
                        <h3 class="text-center">
                            <a href="{{path('downtime-result')}}" data-page="1" data-max-pages="{{pagesCount}}" onclick="loadMore($(this), $('#downtime-page')); return false">Vedi i più vecchi...</a>
                        </h3>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    {% for type in [{
        form: downtimeAdd,
        type:"hunt",
        isHunt:"true",
        description: "Questo downtime verrà eseguito di default quando il numero di downtime disponibili non verrà raggiunto"
    }, {
        form: downtimeNormalCreate,
        type:"normal",
        isHunt:"false",
        description: "Questo downtime verrà eseguito di default quando il numero di downtime disponibili non verrà raggiunto"
        }
    ] %}

        <div class="modal fade" id="{{type.type}}-downtime" tabindex="-1" role="dialog" aria-labelledby="uploaderModal" aria-hidden="true">
            <div class="modal-dialog" role="document">
                {{ form_start(type.form, {action:path('downtime-create')}) }}
                <div class="modal-content">
                    <div class="modal-header">
                        Crea Downtime
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-xs-12">
                                <p>
                                    {{ type.description}}
                                </p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="form-group">
                                    {{ form_row(type.form.associatedMerits, {'attr': {'class': 'form-control', 'onchange':'loadMeritsDt(this, "#'~ type.form.vars.name ~'_title", "#'~ type.form.vars.name ~ '_text", "' ~ path('downtime-load-merits') ~ '",)' }}) }}
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="form-group">
                                    {{ form_row(type.form.title, {'attr': {'class': 'form-control'}}) }}
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <div class="form-group">
                                    {{ form_row(type.form.text, {'attr': {'class': 'form-control'}}) }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-default">Crea</button>
                    </div>
                </div>
                {{ form_row(downtimeAdd.isHunt, {'attr': {'value': type.isHunt}}) }}
                {{ form_end(downtimeAdd) }}
            </div>
        </div>
    {% endfor %}

{% endblock %}
